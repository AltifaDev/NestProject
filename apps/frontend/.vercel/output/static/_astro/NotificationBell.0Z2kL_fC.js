import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.CRC3r6US.js";import{p as g}from"./payload-client.Bgp2zVY_.js";import{c as j}from"./createLucideIcon.BistqCsR.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],N=j("bell",v);function M(){const[f,c]=l.useState(!1),[x,m]=l.useState([]),[d,b]=l.useState(0),u=l.useRef(null);l.useEffect(()=>{const t=n=>{u.current&&!u.current.contains(n.target)&&c(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),l.useEffect(()=>{const t=async()=>{try{const a=g.getUser();if(!a||a.role!=="agent")return;let r=a.agent;typeof r=="object"&&r!==null&&(r=r.id);const o=await fetch(`http://localhost:3000/api/leads?where[agent][equals]=${r}&sort=-createdAt&limit=5`);if(!o.ok)return;const s=await o.json();if(s&&s.docs){m(s.docs);const i=s.docs.filter(w=>w.status==="new").length;b(i)}}catch(a){console.error("Failed to fetch lead notifications",a)}};t();const n=setInterval(t,3e4);return()=>clearInterval(n)},[]);const p=t=>{const n=new Date(t),r=new Date().getTime()-n.getTime(),o=Math.round(r/6e4),s=Math.round(o/60),i=Math.round(s/24);return o<1?"Just now":o<60?`${o} min ago`:s<24?`${s} hr ago`:i===1?"Yesterday":`${i} days ago`},h=()=>{c(!1),window.location.href="/dashboard/leads"};return e.jsxs("div",{className:"relative",ref:u,children:[e.jsxs("button",{onClick:()=>c(!f),className:"w-10 h-10 rounded-xl bg-slate-50 border border-slate-200 flex items-center justify-center text-slate-500 hover:text-blue-600 hover:bg-blue-50 hover:border-blue-200 transition-all relative shadow-sm","aria-label":"Notifications",children:[e.jsx(N,{size:18,strokeWidth:2.5}),d>0&&e.jsx("span",{className:"absolute top-2 right-2.5 w-2 h-2 rounded-full bg-red-500 animate-pulse border border-white"})]}),f&&e.jsxs("div",{className:"absolute right-0 top-12 w-80 bg-white border border-slate-200 rounded-2xl shadow-xl z-50 overflow-hidden transform origin-top-right transition-all",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-sm",children:"Notifications"}),d>0&&e.jsxs("span",{className:"bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-0.5 rounded-full",children:[d," New"]})]}),e.jsx("div",{className:"max-h-[360px] overflow-y-auto",children:x.length>0?x.map((t,n)=>e.jsxs("div",{onClick:h,className:`p-4 border-b border-slate-50 cursor-pointer transition-colors hover:bg-slate-50 flex gap-3 ${t.status==="new"?"bg-blue-50/30":""}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center text-xs font-bold ${t.status==="new"?"bg-blue-100 text-blue-600":"bg-slate-100 text-slate-500"}`,children:t.name?t.name.charAt(0).toUpperCase():"?"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-semibold text-slate-800 truncate",children:["New Lead: ",t.name]}),e.jsx("p",{className:"text-xs text-slate-500 truncate mt-0.5",children:t.message?t.message:"Interested in a property"}),e.jsxs("p",{className:"text-[10px] text-slate-400 font-medium mt-1.5 flex justify-between items-center",children:[e.jsx("span",{children:p(t.createdAt)}),t.status==="new"&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"})]})]})]},t.id||n)):e.jsx("div",{className:"p-6 text-center text-slate-400 text-sm",children:"No recent notifications"})}),e.jsx("div",{className:"p-2 bg-slate-50 border-t border-slate-100",children:e.jsx("button",{onClick:h,className:"w-full text-center text-xs font-bold text-blue-600 hover:text-blue-700 p-2",children:"View all leads"})})]})]})}export{M as default};
