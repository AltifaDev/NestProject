import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.CRC3r6US.js";import{p as h,P as p}from"./payload-client.Bgp2zVY_.js";import{L as v}from"./loader-circle.Bn9BaOCc.js";import{B as y,U as j}from"./user.ChmUyGds.js";import{M as w}from"./mail.DTe58eKs.js";import{P as N,M as k}from"./phone.BsnclMWD.js";import{C as z}from"./clock.CgxgpKB4.js";import"./createLucideIcon.BistqCsR.js";function R(){const[l,c]=i.useState([]),[g,d]=i.useState(!0),[t,n]=i.useState("all");i.useEffect(()=>{u()},[]);const u=async()=>{d(!0);try{const r=h.getUser();if(!r||r.role!=="agent"||!r.agent)return;const a=typeof r.agent=="object"?r.agent.id:r.agent,s=await fetch(`${p}/api/leads?where[agent][equals]=${a}&depth=1&limit=100`,{headers:{Authorization:`JWT ${localStorage.getItem("payload_token")}`}});if(s.ok){const o=await s.json();c(o.docs||[])}}catch(r){console.error("Failed to fetch leads",r)}finally{d(!1)}},x=async(r,a)=>{try{(await fetch(`${p}/api/leads/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`JWT ${localStorage.getItem("payload_token")}`},body:JSON.stringify({status:a})})).ok&&c(l.map(o=>o.id===r?{...o,status:a}:o))}catch(s){console.error("Failed to update status",s)}},f=r=>{switch(r){case"new":return"bg-blue-500/10 text-blue-500 border-blue-500/20";case"contacted":return"bg-yellow-500/10 text-yellow-500 border-yellow-500/20";case"viewing":return"bg-purple-500/10 text-purple-500 border-purple-500/20";case"negotiating":return"bg-orange-500/10 text-orange-500 border-orange-500/20";case"closed_won":return"bg-green-500/10 text-green-500 border-green-500/20";case"closed_lost":return"bg-red-500/10 text-red-500 border-red-500/20";default:return"bg-gray-500/10 text-gray-500 border-gray-500/20"}},b=r=>{switch(r){case"new":return"New Lead";case"contacted":return"Contacted";case"viewing":return"Viewing Arranged";case"negotiating":return"Negotiating";case"closed_won":return"Closed (Won)";case"closed_lost":return"Closed (Lost)";default:return r}},m=l.filter(r=>t==="all"?!0:t==="active"?["new","contacted","viewing","negotiating"].includes(r.status):t==="closed"?["closed_won","closed_lost"].includes(r.status):r.status===t);return g?e.jsxs("div",{className:"lcrm-loading",children:[e.jsx(v,{className:"animate-spin"})," Loading Leads..."]}):e.jsxs("div",{className:"lcrm-container",children:[e.jsxs("div",{className:"lcrm-header",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"lcrm-title",children:"Leads & CRM Pipeline"}),e.jsx("p",{className:"lcrm-description",children:"Track your client inquiries and deal progress."})]}),e.jsxs("div",{className:"lcrm-filters",children:[e.jsx("button",{className:t==="all"?"active":"",onClick:()=>n("all"),children:"All Leads"}),e.jsx("button",{className:t==="active"?"active":"",onClick:()=>n("active"),children:"Active"}),e.jsx("button",{className:t==="closed"?"active":"",onClick:()=>n("closed"),children:"Closed"})]})]}),m.length===0?e.jsxs("div",{className:"lcrm-empty",children:[e.jsx(y,{size:40,className:"lcrm-empty-icon"}),e.jsx("p",{children:"No leads found in this category."}),e.jsx("p",{className:"lcrm-empty-sub",children:"When clients contact you regarding properties, they will appear here."})]}):e.jsx("div",{className:"lcrm-grid",children:m.map(r=>e.jsxs("div",{className:"lcrm-card",children:[e.jsxs("div",{className:"lcrm-card-header",children:[e.jsxs("div",{className:"lcrm-card-title",children:[e.jsx(j,{size:16}),e.jsx("h3",{children:r.name})]}),e.jsx("span",{className:`lcrm-status-badge ${f(r.status)}`,children:b(r.status)})]}),e.jsxs("div",{className:"lcrm-card-body",children:[(r.email||r.phone)&&e.jsxs("div",{className:"lcrm-contact-info",children:[r.email&&e.jsxs("div",{className:"lcrm-info-row",children:[e.jsx(w,{size:14})," ",e.jsx("span",{children:r.email})]}),r.phone&&e.jsxs("div",{className:"lcrm-info-row",children:[e.jsx(N,{size:14})," ",e.jsx("span",{children:r.phone})]})]}),r.property&&e.jsxs("div",{className:"lcrm-property-ref",children:[e.jsx("strong",{children:"Inquiry for:"})," ",r.property.title]}),r.message&&e.jsxs("div",{className:"lcrm-message",children:[e.jsx(k,{size:14,className:"lcrm-msg-icon"}),e.jsx("p",{children:r.message})]}),e.jsxs("div",{className:"lcrm-info-row lcrm-timestamp",children:[e.jsx(z,{size:12}),e.jsxs("span",{children:["Received ",new Date(r.createdAt).toLocaleDateString()]})]})]}),e.jsx("div",{className:"lcrm-card-footer",children:e.jsxs("select",{value:r.status,onChange:a=>x(r.id,a.target.value),className:"lcrm-status-select",children:[e.jsx("option",{value:"new",children:"Move to: New"}),e.jsx("option",{value:"contacted",children:"Move to: Contacted"}),e.jsx("option",{value:"viewing",children:"Move to: Viewing"}),e.jsx("option",{value:"negotiating",children:"Move to: Negotiating"}),e.jsx("option",{value:"closed_won",children:"Deal Won"}),e.jsx("option",{value:"closed_lost",children:"Deal Lost"})]})})]},r.id))}),e.jsx("style",{children:`
                .lcrm-container { display: flex; flex-direction: column; gap: 1.5rem; width: 100%; max-width: 1200px; margin: 0 auto; }
                .lcrm-header { display: flex; justify-content: space-between; align-items: center; background: var(--bg-card); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border-subtle); flex-wrap: wrap; gap: 1rem; }
                .lcrm-title { font-size: 1.25rem; font-weight: 600; color: var(--text-main); margin-bottom: 0.25rem; }
                .lcrm-description { font-size: 0.85rem; color: var(--text-muted); }
                
                .lcrm-filters { display: flex; gap: 0.5rem; background: var(--bg-main); padding: 0.25rem; border-radius: 8px; border: 1px solid var(--border-subtle); }
                .lcrm-filters button { background: transparent; border: none; padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.8rem; font-weight: 500; color: var(--text-muted); cursor: pointer; transition: all 0.2s; }
                .lcrm-filters button:hover { color: var(--text-main); }
                .lcrm-filters button.active { background: var(--text-main); color: var(--bg-main); }

                .lcrm-loading { padding: 4rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; color: var(--text-muted); }
                
                .lcrm-empty { padding: 5rem 2rem; background: var(--bg-card); border-radius: 12px; border: 1px dashed var(--border-medium); text-align: center; color: var(--text-muted); }
                .lcrm-empty-icon { opacity: 0.3; margin-bottom: 1rem; }
                .lcrm-empty p { font-size: 1rem; font-weight: 500; color: var(--text-main); }
                .lcrm-empty .lcrm-empty-sub { font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem; font-weight: 400; }

                .lcrm-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.25rem; }
                
                .lcrm-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; transition: transform 0.2s, box-shadow 0.2s; }
                .lcrm-card:hover { transform: translateY(-2px); box-shadow: 0 10px 20px -10px rgba(0,0,0,0.15); border-color: var(--border-medium); }

                .lcrm-card-header { padding: 1.25rem; border-bottom: 1px solid var(--border-subtle); display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem; }
                .lcrm-card-title { display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); }
                .lcrm-card-title h3 { font-size: 1rem; font-weight: 600; margin: 0; line-height: 1.2; }
                .lcrm-status-badge { font-size: 0.65rem; font-weight: 700; text-transform: uppercase; padding: 0.2rem 0.6rem; border-radius: 99px; border: 1px solid; white-space: nowrap; }

                .lcrm-card-body { padding: 1.25rem; display: flex; flex-direction: column; gap: 1rem; flex: 1; }
                
                .lcrm-contact-info { display: flex; flex-direction: column; gap: 0.4rem; background: var(--bg-main); padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border-subtle); }
                .lcrm-info-row { display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: var(--text-main); }
                .lcrm-info-row svg { color: var(--text-muted); }

                .lcrm-property-ref { font-size: 0.8rem; color: var(--text-main); background: rgba(59,130,246,0.1); padding: 0.5rem 0.75rem; border-radius: 6px; border-left: 3px solid var(--accent-primary); }
                .lcrm-property-ref strong { color: var(--accent-primary); font-weight: 600; }

                .lcrm-message { font-size: 0.85rem; color: var(--text-muted); line-height: 1.5; background: var(--bg-main); padding: 0.75rem; border-radius: 8px; position: relative; }
                .lcrm-msg-icon { position: absolute; top: 0.75rem; left: 0.75rem; opacity: 0.3; }
                .lcrm-message p { margin: 0; padding-left: 1.5rem; }

                .lcrm-timestamp { font-size: 0.75rem; color: var(--text-dim); margin-top: auto; }

                .lcrm-card-footer { padding: 0.75rem 1.25rem; background: var(--bg-main); border-top: 1px solid var(--border-subtle); }
                .lcrm-status-select { width: 100%; background: var(--bg-card); color: var(--text-main); border: 1px solid var(--border-subtle); padding: 0.5rem; border-radius: 6px; font-size: 0.8rem; font-weight: 500; cursor: pointer; }
                .lcrm-status-select:focus { outline: none; border-color: var(--accent-primary); }
            `})]})}export{R as default};
